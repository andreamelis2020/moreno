app.controller("FiltriController",["$scope","FiltriService","GeneralService","RicercaService","$location","$anchorScroll","$sce","$timeout","$q",function(n,a,g,d,f,h,m,c,j){n.contents=[];n.renderContent=[];n.renderContentSecondModel=[];n.calendar=[];n.orCategory=false;n.filters="";n.fulltext="";n.events=[];n.renderEventContent=[];n.categoryContent=[];n.dayName=[];n.loader=[];n.full=[];n.empty=false;n.argomenti=[];n.ammins_chk=[];n.servizi_chk=[];n.novita_chk=[];n.docs_chk=[];n.ammins_selected=[];n.servizi_selected=[];n.novita_selected=[];n.docs_selected=[];n.args_selected=[];n.categoriaTab="active";n.argomentoTab="";n.opzioniTab="";n.active_chk=null;n.data_inizio=null;n.data_fine=null;n.categorie=[];n.cercatxt="";n.General=g;n.searchParameters={};const e=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"];n.setParameters=function(u,o,v,w,s,q,t,p,r,x){if(x!==undefined&&x!=""){a.userToken=x}n.pageSize=parseInt(u);if(s!=""){n.categorie=s}if(o!=""){n.maxElements=parseInt(o)}if(v){n.contentType=v}if(p!=""){n.filters=p}if(t=="true"){n.orCategory=true}if(r&&r!="multi"){n.setContents(r)}else{if(r=="multi"){n.getMultiContents(n.contentType,s,q)}else{n.getContents(v,w,s,q)}}};n.setCalendarParameters=function(q,u,r,p,o,s){if(s!==undefined&&s!=""){a.userToken=s}n.oneMonth=true;n.day=q;n.finemese=u;n.days=u-q;for(i=0;i<=n.days;i++){n.calendar[i]=i+parseInt(n.day);n.full[n.calendar[i]]=true}if(n.days<=9){n.oneMonth=false;var t=new Date();n.nextMonth=e[t.getMonth()+1];n.daysOld=angular.copy(n.days)+1;n.day=1;n.finemese=10-n.days;n.days=n.finemese-n.day;for(i=0;i<=n.days;i++){n.calendar[i+n.daysOld]=i+parseInt(n.day);n.full[n.calendar[i+n.daysOld]]=true}}n.pageSize=parseInt(p);if(o!=""){n.maxElements=parseInt(o)}};n.getContents=function(u,t,s,r,q,o){n.countEmpty=0;if(q!=undefined){n.filters=q}if(n.searchParameters){for(var p in n.searchParameters){if(n.searchParameters[p]!=null){switch(n.searchParameters[p].type){case"date":if(n.filters==""){n.filters+="(attributeFilter=true;key="+p+";start="+n.searchParameters[p].start+";end="+n.searchParameters[p].end+";)"}else{n.filters+="+(attributeFilter=true;key="+p+";start="+n.searchParameters[p].start+";end="+n.searchParameters[p].end+";)"}break;case"select":if(n.filters==""){n.filters+="(attributeFilter=true;key="+p+";value="+n.searchParameters[p].key+";)"}else{n.filters+="+(attributeFilter=true;key="+p+";value="+n.searchParameters[p].key+";)"}break;case"boolean":if(n.filters==""){n.filters+="(attributeFilter=true;key="+p+";value="+n.searchParameters[p].value+";)"}else{n.filters+="+(attributeFilter=true;key="+p+";value="+n.searchParameters[p].value+";)"}break;case"text":if(p!="fulltext"){if(n.filters==""){n.filters+="(attributeFilter=true;key="+p+";value="+n.searchParameters[p].value+";likeOption=true;)"}else{n.filters+="+(attributeFilter=true;key="+p+";value="+n.searchParameters[p].value+";likeOption=true;)"}}else{n.fulltext=n.searchParameters[p].value}break;default:if(n.filters==""){n.filters+="(attributeFilter=true;key="+p+";value="+n.searchParameters[p]+";)"}else{n.filters+="+(attributeFilter=true;key="+p+";value="+n.searchParameters[p]+";)"}}}}}n.currentPage=0;n.pages=[];if(r){b(r,n.oldElem);n.oldElem=r}a.getContents(u,s,n.filters,n.fulltext,o).then(function(v){n.events[o]=[];if(v==undefined){n.full[o]=false;n.countEmpty=n.countEmpty+1}if(v!=undefined){n.loader[o]=true;if(!Array.isArray(v)){if(v.$){n.contents=[];n.contents[0]=v;n.events[o].push(v)}}else{if(n.maxElements>=v.length){n.contents=v;n.events[o]=v}else{for(w=0;w<n.maxElements;w++){n.contents[w]=v[w];n.events[o]=v[w]}}}n.numberOfPages=Math.ceil(n.contents.length/n.pageSize);for(w=0;w<n.numberOfPages;w++){n.pages[w]=w+1}if(o!=undefined){n.renderEventContent[o]=[];n.categoryContent[o]=[];for(var w in n.events[o]){a.getContent(n.events[o][w].$,t).then(function(x){n.renderEventContent[o][x.item.id]=m.trustAsHtml(x.html);n.loader[o]=false;n.categoryContent[o][x.item.id]="";for(var y in x.item.categories.category){if(x.item.categories.category[y]!=undefined){n.categoryContent[o][x.item.id]+=x.item.categories.category[y]}}},function(x){n.loader[o]=false;console.error("Errore durante il caricamento del contenuto")})}}}else{n.contents=[]}if(n.countEmpty!=n.calendar.length&&u=="EVN"){c(k,1000)}else{n.empty=true}},function(v){n.contents=[];n.loader[o]=false})};n.getMultiContents=function(o,u,t,q,s){var p="";var r="";if(o==undefined){if(n.searchParameters.type=="contentType"){o=n.searchParameters.key}else{o=n.contentType}}if(n.searchParameters.type=="tipologia"){p=n.searchParameters.key}if(n.searchParameters.type=="fulltext"){r=n.searchParameters.key}if(q!=undefined){n.filters=q}if(s!==undefined){page="&page="+s}else{s=1;page="&page=1"}n.pages=[];n.goToPage(s-1);if(t){b(t,n.oldElem);n.oldElem=t}a.getMultiContents(n.pageSize,o,u,n.orCategory,n.filters,p,r,page).then(function(v){n.contents=v.payload;n.totalItems=String(v.metaData.totalItems);n.numberOfPages=String(v.metaData.lastPage);for(i=0;i<n.numberOfPages;i++){n.pages[i]=i+1}},function(v){n.contents=[]})};n.getContent=function(p,o){if(p!==undefined){n.renderContent[p]=[];if(o===undefined){o="list"}a.getContent(p,o).then(function(q){n.renderContent[q.item.id][o]=m.trustAsHtml(l(q.html))},function(q){console.error("Errore durante il caricamento del contenuto")})}};n.getTableHeader=function(p,o){if(o===undefined){o="list"}a.getContent(p,o).then(function(q){n.tableHeader=[];var r=$(q.html);r.each(function(){var s=$(this).attr("data-thead");if(s){n.tableHeader.push(s)}})},function(q){console.error("Errore durante il caricamento del contenuto")})};function l(q){var o,s,r;o=window.navigator.userAgent;s=/msie|Trident.*rv[ :]*11\./gi;r=s.test(o);if(r){var p=$(q);var t=p.find("img").prop("src");if(t){p.find(".img-fit-cover").css("backgroundImage","url("+t+")").addClass("img-fit-ie");return p.prop("outerHTML")}else{return q}}else{return q}c(n.jQueryEvents,1000)}function b(p,o){if(o){var r=document.getElementById(o);$(r).removeClass("active")}if(p!=""){var q=document.getElementById(p);$(q).addClass("active")}}n.goToPage=function(o){n.currentPage=o};n.goToFirstPage=function(){n.currentPage=0};n.refreshPage=function(){n.currentPage=1;c(n.goToFirstPage,1000)};n.getFilterDay=function(o,s,q){var r=parseInt(s)-1;var p=new Date(q,r,o);n.dayName[o]=p.toLocaleString(undefined,{weekday:"short"});return"(attributeFilter=true;key=data_iniz;start="+o+"/"+s+"/"+q+";end="+o+"/"+s+"/"+q+")"};n.setContents=function(p){n.contents=p.replace(/=/g,'":"');n.contents=n.contents.replace(/}/g,'"}');n.contents=n.contents.replace(/contentId/g,'"contentId').replace(/modelId/g,'"modelId');n.contents=n.contents.replace(/, "/g,'", "');n.contents=JSON.parse(n.contents);if(n.pageSize!=0){n.numberOfPages=Math.ceil(n.contents.length/n.pageSize)}else{n.numberOfPages=1}n.pages=[];n.currentPage=0;for(o=0;o<n.numberOfPages;o++){n.pages[o]=o+1}for(var o in n.contents){a.getContent(n.contents[o].contentId,n.contents[o].modelId).then(function(q){n.renderContent[q.item.id]=m.trustAsHtml(q.html)},function(q){console.error("Errore durante il caricamento del contenuto")})}};function k(){var o=$("#owl-calendario");o.owlCarousel({nav:false,navElement:"a",startPosition:0,autoPlay:false,responsiveClass:true,responsive:{0:{items:1,},576:{items:2,},768:{items:3,},991:{items:4,},}})}n.setArgomenti=function(p,o){if(p!="Argomenti"){n.argomenti.push({name:p.replace("%","'"),code:o})}};n.setCategorie=function(p,o){switch(o){case"amministrazione":ammins_chk.push(p);break;case"novita":novita_chk.push(p);break;case"servizi":servizi_chk.push(p);break;case"documenti":docs_chk.push(p);break}};n.getArgomentiList=function(){var q="";if(n.categorie){q=n.categorie}for(var p in n.args_selected){var o=q[q.length-1];if(o===undefined||o==","){q+=n.args_selected[p].code+""}else{q+=","+n.args_selected[p].code}}for(var p in n.ammins_selected){if(q==""){q+=n.ammins_selected[p].code+""}else{q+=","+n.ammins_selected[p].code}}for(var p in n.servizi_selected){if(q==""){q+=n.servizi_selected[p].code+""}else{q+=","+n.servizi_selected[p].code}}for(var p in n.novita_selected){if(q==""){q+=n.novita_selected[p].code+""}else{q+=","+n.novita_selected[p].code}}for(var p in n.docs_selected){if(q==""){q+=n.docs_selected[p].code+""}else{q+=","+n.docs_selected[p].code}}return q};n.cleanSearchParameter=function(o){if(o=="all"){n.searchParameters={}}else{delete n.searchParameters[o]}};n.toggle=function(q,r){var o=r.indexOf(q);if(q.code&&r.length>0){for(var p in r){if(r[p].code==q.code){o=p}}}if(o>-1){r.splice(o,1);b("",q.code)}else{r.push(q);b(q.code)}};n.exists=function(o,p){return p.indexOf(o)>-1};n.ammins_isIndeterminate=function(){return(n.ammins_selected.length!==0&&n.ammins_selected.length!==n.ammins_chk.length)};n.ammins_isChecked=function(){return n.ammins_selected.length===n.ammins_chk.length};n.ammins_toggleAll=function(){if(n.ammins_selected.length===n.ammins_chk.length){n.ammins_selected=[]}else{if(n.ammins_selected.length===0||n.ammins_selected.length>0){n.ammins_selected=n.ammins_chk.slice(0)}}};n.servizi_isIndeterminate=function(){return(n.servizi_selected.length!==0&&n.servizi_selected.length!==n.servizi_chk.length)};n.servizi_isChecked=function(){return n.servizi_selected.length===n.servizi_chk.length};n.servizi_toggleAll=function(){if(n.servizi_selected.length===n.servizi_chk.length){n.servizi_selected=[]}else{if(n.servizi_selected.length===0||n.servizi_selected.length>0){n.servizi_selected=n.servizi_chk.slice(0)}}};n.novita_isIndeterminate=function(){return(n.novita_selected.length!==0&&n.novita_selected.length!==n.novita_chk.length)};n.novita_isChecked=function(){return n.novita_selected.length===n.novita_chk.length};n.novita_toggleAll=function(){if(n.novita_selected.length===n.novita_chk.length){n.novita_selected=[]}else{if(n.novita_selected.length===0||n.novita_selected.length>0){n.novita_selected=n.novita_chk.slice(0)}}};n.docs_isIndeterminate=function(){return(n.docs_selected.length!==0&&n.docs_selected.length!==n.docs_chk.length)};n.docs_isChecked=function(){return n.docs_selected.length===n.docs_chk.length};n.docs_toggleAll=function(){if(n.docs_selected.length===n.docs_chk.length){n.docs_selected=[]}else{if(n.docs_selected.length===0||n.docs_selected.length>0){n.docs_selected=n.docs_chk.slice(0)}}};n.toggleAll=function(o){if(o=="categorie"){n.ammins_selected=[];n.servizi_selected=[];n.novita_selected=[];n.docs_selected=[]}if(o=="argomenti"){n.args_selected=[]}switch(o){case"categorie":n.ammins_selected=[];n.servizi_selected=[];n.novita_selected=[];n.docs_selected=[];break;case"argomenti":n.args_selected=[];break;default:n.ammins_selected=[];n.servizi_selected=[];n.novita_selected=[];n.docs_selected=[];n.args_selected=[];n.active_chk=null;n.clean_date()}};n.class_tutti=function(o){n.searchParametersLength=0;if(n.searchParameters){n.searchParametersLength=Object.keys(n.searchParameters).length}switch(o){case"categorie":if(n.ammins_selected.length!==0||n.servizi_selected.length!==0||n.novita_selected.length!==0||n.docs_selected.length!==0||n.searchParametersLength!==0||n.searchParameters!==undefined){return""}else{return"active"}break;default:if(n.ammins_selected.length!==0||n.servizi_selected.length!==0||n.novita_selected.length!==0||n.docs_selected.length!==0||n.args_selected.length!==0||n.active_chk!=null||n.data_inizio!=null||n.data_fine!=null||n.searchParametersLength!==0){return""}else{return"active"}break}};n.class_categorie=function(o,p){if(o.length!==0&&o.length!==p.length){return"active"}else{if(o.length===p.length){return"active"}else{return""}}};n.unchk=function(p,q){var o=q.indexOf(p);if(o>-1){q.splice(o,1)}};n.clean_date=function(){n.data_inizio=null;n.data_fine=null};n.setActive=function(o){switch(o){case"argomenti":n.categoriaTab="";n.argomentoTab="active";n.opzioniTab="";break;case"opzioni":n.categoriaTab="";n.argomentoTab="";n.opzioniTab="active";break;default:n.categoriaTab="active";n.argomentoTab="";n.opzioniTab=""}};n.setArgsSelected=function(o){if(o!=""){n.args_selected=o.split(",")}};n.setCatSelected=function(o,p){if(p!=""){switch(o){case"amministrazione":n.ammins_selected=p.split(",");break;case"servizi":n.servizi_selected=p.split(",");break;case"novita":n.novita_selected=p.split(",");break;case"documenti":n.docs_selected=p.split(",");break;default:}}};n.selectedRicercaTxtItemChanged=function(o){if(o!==undefined&&o.contentName!==undefined){cercatxt=o.contentName}if(o===undefined){cercatxt=""}};n.listLengthWithoutElem=function(q,p,o){var r=q.length;if(q.indexOf(p)!=-1){r--}if(q.indexOf(o)!=-1){r--}return r};n.scrollTo=function(o){angular.element("html, body").animate({scrollTop:$("#"+o).offset().top},800)}}]);app.filter("startFrom",function(){return function(a,b){b=+b;return a.slice(b)}});