app.factory("FiltriService",["$http","$q","GeneralService",function(n,w,y){var h=y.getBaseURL()+"/legacyapi/rs/it/jacms",z=y.getBaseURL()+"/api/plugins/advcontentsearch";return{getContents:function(k,c,e,a){var f="",p="",q="";void 0!=c&&""!=c&&(f=c.split(","),f=1<f.length&&""!=f[1]&&-1==f.indexOf("evd")?"&categories="+c+"&orClauseCategoryFilter=true":"&categories="+c);""!=e&&void 0!=e&&(p="&filters="+e.replace(/\+/g,"%2B"));""!=a&&void 0!=a&&(q="&fulltext="+a);var l=w.defer();this.userToken?n({method:"GET",
url:h+"/contentsExtended.json?contentType="+k+f+p+q,headers:{Authorization:"Bearer "+this.userToken}}).then(function(a){l.resolve(a.data.response.result.items.item)},function(a){console.error(a);l.reject(a)}):n({method:"GET",url:h+"/contentsExtended.json?contentType="+k+f+p+q}).then(function(a){l.resolve(a.data.response.result.items.item)},function(a){console.error(a);l.reject(a)});return l.promise},getMultiContents:function(k,c,e,a,f,p,q,l){var t,r,h,m;var x=t=r=h=m="";var g=0;c?(t="&filters["+g+
"].attribute=typeCode&filters["+g+"].operator=eq&filters["+g+"].allowedValues="+c,g++):t="";if(void 0!=f&&""!=f){c=[];var b=[];c=f.split("+");for(var u in c){b=c[u].substring(1,c[u].length-1).split(";");for(var d in b)-1!=b[d].indexOf("key")&&(m+="&filters["+g+"].entityAttr="+b[d].substring(b[d].lastIndexOf("=")+1)),-1!=b[d].indexOf("order")&&(m+="&filters["+g+"].order="+b[d].substring(b[d].lastIndexOf("=")+1)),-1!=b[d].indexOf("operator")&&(m+="&filters["+g+"].operator="+b[d].substring(b[d].lastIndexOf("=")+
1)),-1!=b[d].indexOf("type")&&(m+="&filters["+g+"].type="+b[d].substring(b[d].lastIndexOf("=")+1)),-1!=b[d].indexOf("value")&&(m+="&filters["+g+"].value="+b[d].substring(b[d].lastIndexOf("=")+1));g++}}""!=p&&(h="&filters["+g+"].entityAttr=jpattributeextended:sottosezione&filters["+g+"].value="+p,g++);if(void 0!=e&&""!=e.toString())if(f=0,a)r="&csvCategories[0]="+e;else for(u in a=[],a=e.split(","),a)""!=a[u]&&(r+="&csvCategories["+f+"]="+a[u],f++);else r="";q&&(x="&text="+q);var v=w.defer();this.userToken?
n({method:"GET",url:encodeURI(z+"/contents.json?pageSize="+k+l+t+x+r+m+h),headers:{Authorization:"Bearer "+this.userToken}}).then(function(a){v.resolve(a.data)},function(a){console.error(a);v.reject(a)}):n({method:"GET",url:encodeURI(z+"/contents.json?pageSize="+k+l+t+x+r+m+h)}).then(function(a){v.resolve(a.data)},function(a){console.error(a);v.reject(a)});return v.promise},getContent:function(k,c){var e=w.defer();this.userToken?n({method:"GET",url:h+"/content.json?id="+k+"&modelId="+c,headers:{Authorization:"Bearer "+
this.userToken}}).then(function(a){e.resolve(a.data.response.result)},function(a){console.error(a);e.reject(a)}):n({method:"GET",url:h+"/content.json?id="+k+"&modelId="+c}).then(function(a){e.resolve(a.data.response.result)},function(a){console.error(a);e.reject(a)});return e.promise}}}]);